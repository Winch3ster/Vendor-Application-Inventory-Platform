@using Vendor_Application_Inventory_Platform.Areas.User.ViewModels;
@using Vendor_Application_Inventory_Platform.Areas.User.Controllers;
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@model SoftwareIndexVM

@{
    Layout = "_EmployeeControlPanel";
    ViewData["title"] = "Home";
}


<div>
    <h3>Hey there! Welcome back to Vendor Application Inventory</h3>
    <div class="input-group mt-4">
       

        <form asp-action="Index" method="get" >


            <div class="p-0 border-1 rounded p-2 d-flex align-items-center justify-content-between">
                <div class="form-floating">

                    <input type="text" class="form-control" id="search" placeholder="Username" size="30" name="searchString">
                    <label for="search">Look for the application name <i class="bi-search"></i></label>
                </div>
                <button type="submit" hidden></button>

            </div>
          

     
        </form>
    </div>






</div>
<div class="mt-5">
    <h3>Result(s)</h3>
    <div id="filter" class="d-flex mb-2"></div>
    <div class="row gy-4">

        @foreach (var returnedSoftware in Model.returnedSoftwares)
        {
            <div class="col-lg-4" style="margin: 20px 0">
                <!-- <p@returnedSoftware.SoftwareName</p> -->
                <img src="../../@Url.Content(returnedSoftware.ImagePath)" class="software-image-link" style="width:250px; height:200px; object-fit:contain; object-position:center" onclick="NavigateToViewDetailsPage(@returnedSoftware.SoftwareID)" />
            </div>
        }

    </div>
</div>
<div class="mt-5">
    <h3>Recently Viewed</h3>
    <div class="row g-4">
        @foreach (var recentlyViewedSoftware in Model.recentlyViewed)
        {
            <div class="col-lg-4" style="margin: 20px 0">
                <!-- <p@returnedSoftware.SoftwareName</p> -->
                <img src="../../@Url.Content(recentlyViewedSoftware.ImagePath)" class="software-image-link" style="width:250px; height:200px; object-fit:contain; object-position:center" onclick="NavigateToViewDetailsPage(@recentlyViewedSoftware.SoftwareID)" />
            </div>
        }
        
    </div>
</div>
@section Scripts{
    <script>
        $(document).ready(function () {
            // Show filter selection on html page
            $("input[type='checkbox']").on('change', function (e) {
                if ($(e.target).is(':checked')) {
                    $('#filter').append("<div class='mx-1 bg-secondary rounded px-2 text-white'>" + e.target.id + `<span class='bi bi-x'></span></div>`)
                }
                else {
                    $('#filter').find("div:contains(" + e.target.id + ")").remove();
                }
            })

            //Delete filter selection when X is clicked
            $("#filter").on('click', '.bi-x', function () {
                let label = $(this).closest('div').text().trim();
                $('input#' + label).prop('checked', false);
                $(this).closest('div').remove();
            });

        })


        function NavigateToViewDetailsPage(softwareid) {
            console.log(`Going to page with id: ${softwareid}`)
            // Replace 'YourController' and 'YourAction' with the appropriate controller and action names
            var url = '@Url.Action("Details", "Software", new { softwareid = "__softwareid__" })';
            url = url.replace('__softwareid__', softwareid);
            window.location.href = url;
        }

    </script>
}